# USER ACCOUNTS MANAGEMENT

User management in Linux involves the creation, modification, and removal of user accounts, as well as the management of associated permissions and privileges. It is a crucial aspect of system administration, ensuring secure and efficient access to resources on the system.
The two main folders involved in user management are `/etc/passwd` and `/etc/shadow`. Here are some key notes on user management in Linux:

`/etc/passwd`:

This file contains essential information about each user account on the system. Each line represents a user account and is composed of several fields separated by colons (:). Fields include username, password placeholder (actual password hash stored in /etc/shadow), UID, GID, user's full name or description, home directory, and login shell.

Example: `backup:x:34:34:backup:/var/backups:/usr/sbin/nologin`
- `backup`: This is the username of the user.
- `x`: This field traditionally held the hashed password of the user. However, modern systems typically store the password hashes in the - /etc/shadow file for security reasons. The x here indicates that the password hash is stored in the /etc/shadow file.
- `34`: This is the numerical user ID (UID) of the user. It uniquely identifies the user within the system.
- `34`: This is the numerical group ID (GID) of the user's primary group. It specifies which group the user belongs to.
- `backup`: This is the user's full name or a description of the user account.
- `/usr/sbin/nologin`: This is the user's shell. It specifies the command or program that will be executed when the user logs in. In this case, `/usr/sbin/nologin` indicates that the user cannot log in interactively, as it is a special shell that displays a message indicating that the account is not available for login. These settings are typically used for system accounts or accounts that should not have interactive shell access for security or administrative reasons.

`/etc/shadow`:

This file stores user account passwords in an encrypted format, enhancing security by protecting password information. Each line represents a user account and is composed of several fields separated by colons (:). Fields include username, encrypted password, password change and expiration information, and other account-related settings. The password field typically contains a hash generated using a hashing algorithm, along with a salt for added security.

Example: `seun:$y$j9T$aByJlLDW1APOvddbxH0oC1$aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8:19733:5:99999:7:60:15050:`
- `seun`: This is the username of the user.
- `$y$`: This field indicates the type of hashing algorithm used to generate the hash. In this case, $y$ typically represents bcrypt hashing.
- `j9T$aByJlLDW1APOvddbxH0oC1`: This is the hash value generated by the bcrypt hashing algorithm. It represents the hashed password.
- `aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8`: This appears to be the salt value used during the hashing process. The salt is combined with the password before hashing to add randomness and strengthen security.
- `19733:` This field represents the number of days since the Unix epoch (January 1, 1970) when the password was last changed.
- `5:` This field represents the minimum number of days required between password changes.
- `99999:` This field represents the maximum number of days the password is valid before it must be changed.
- `7:` This field represents the number of days before a password change is required for a warning to be issued.
- `60`: This field represents the number of days after the password expiration date that the account is disabled.
- `15050`: This field represents the date when the account was last used, measured in days since the Unix epoch.

### HASH PASSWORD FORMAT EXPLAINED

In Linux and many other systems, passwords are stored in a hashed format for security reasons. The format `$type$salt$hash` is commonly used to represent hashed passwords.

- $type: Indicates the type of hashing algorithm used to generate the hash. This part of the format specifies the algorithm used for password encryption. Different hash algorithms have different identifiers. For example: </br>
  - 1 typically represents MD5 hashing.</br>
  - 2a (blowfish) or 2y (Eksblowfish) typically represents bcrypt hashing.</br>
  - 5 typically represents SHA-256 hashing.</br>
  - 6 typically represents SHA-512 hashing.

<img width="526" alt="2y - Eksblowfish" src="https://github.com/ikechukwu25/Mastering-Linux/assets/64879420/98da424c-af14-47b4-a8ac-576504ff3898">

- $salt: The salt value used during the hashing process. A salt is a randomly generated string of characters that is combined with the password before hashing. Salting adds randomness to the hashing process and helps protect against dictionary and rainbow table attacks.

- $hash: The resulting hash value obtained after applying the hashing algorithm to the password concatenated with the salt. This value represents the final hashed password, which is stored in the system for authentication purposes.

Knowledge of hashing algorithms and salts aids in evaluating the security of password storage practices and implementing appropriate measures to protect sensitive user credentials.

We'll use the previous has in the shadow file as an example; 

`$y$j9T$aByJlLDW1APOvddbxH0oC1$aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8`
- $type: `$y$` indicates bcrypt hashing.
- $salt: `j9T` is the salt value used.
- $hash: `aByJlLDW1APOvddbxH0oC1` is the resulting hash of the password concatenated with the salt.
- `iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8`: This is the final hash value obtained after applying the bcrypt hashing algorithm, representing the hashed password. It is the output of the password hashing process and is stored in the system for authentication purposes.


## SECURITY

The `/etc/shadow` file contains critical security information related to user passwords on Unix-like systems. Each entry in this file represents a user account and includes various fields about password management and security policies. Understanding and managing entries in /etc/shadow is essential for maintaining the integrity and security of user authentication on the system. 

Here are the crucial parameters extracted from the /etc/shadow entry for the user "seun"  seun:`$y$j9T$aByJlLDW1APOvddbxH0oC1$aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8`:19733:5:99999:7:60:15050:

- Password: `$y$j9T$aByJlLDW1APOvddbxH0oC1$aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8`</br>
The password field contains the encrypted password for the account. This very long string is a one-way encryption, meaning that it can't be "reversed" to determine the original password.
  
- Last Change: `19733` </br>
This field contains a number that represents the last time the password was changed. The number 19733 is the number of days since January 1, 1970 (called the **Epoch**).

- Minimum: `5` </br>
This field indicates the minimum number of days between password changes. It is one of the password aging fields; a non-zero value in this field indicates that after a user changes their password, the password can't be changed again for the specified number of days, 5 days in this example.

- Maximum: `99999` </br>
This field indicates the maximum number of days the password is valid. It is used to force users to change their passwords on a regular basis. A value of 30 in this field means the user must change their password at least every 30 days to avoid having their account locked out.</br>
Setting a maximum password age without a corresponding minimum password age could allow users to reset their password to the original value immediately after changing it, potentially undermining the security intention of regular password changes. Therefore, it's advisable to set both minimum and maximum password ages to enforce password rotation policies effectively.

- Warn:  `7` </br>
If the maximum field is set, the warning field indicates the number of days before password expiry that the system warns the user. 

- Inactive: `60` </br>
If the user ignores the warnings and exceeds the password timeframe, their account will be locked out. In that case, the inactive field provides the user with a "grace" period in which their password can be changed, but only during the login process. If the inactive field is set to 60, the user has 60 days to change to a new password. If they fail to do so, then the administrator would be needed to reset the password for the user.

- Expire: `15050` </br>
This field indicates the day the account will expire, represented by the number of days from January 1, 1970. An expired account is locked, not deleted, meaning the administrator can reset the password to unlock the account

N/B: In addition to the grep command, another technique for retrieving user information contained in the `/etc/passwd` and `/etc/shadow` files is to use the `getent` command. 

`ikechukwu@ubuntu-22-04-3:~$ getent passwd seun`
`seun:$y$j9T$aByJlLDW1APOvddbxH0oC1$aUSViRiZM.iy8qnvsJviLk78cfXh40p1YzGh5LTnyO8:19733:5:99999:7:60:15050:`


# SYSTEM ACCOUNTS

Regular user accounts typically have UID values greater than 500 (or 1,000 on some systems), while the root user, which has special access to the system, is assigned a UID of 0.

Accounts with User IDs (UIDs) ranging from 1 to 499 are known as system accounts. They are intended for services and system processes rather than user login.

System accounts have some fields in the `/etc/passwd` and `/etc/shadow` files that are different than other accounts. For example, system accounts rarely have home directories as they typically are not used to create or store files. In the `/etc/passwd` file, system accounts have a non-login program in the shell field. For example: </br>

`sshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin`

### USER ACCOUNT INFORMATION

| Username | Terminal | Login time | Display |
|-----|-----|-----|-----|
| root | tty2 | 2013-10-11 10:00 |   |
| sysadmin | pts/0 | 2013-10-11 09:59 | (:0.0) |	

This table indicates which terminal window the user is working in. If the terminal name starts with tty, then this is an indication of a local login, as this is a regular command line terminal. If the terminal name starts with pts, then this indicates the user is using a pseudo-terminal or running a process that acts as a terminal.

### USER ACCOUNT MONITORING (whoami, who am i, who, id, w, uptime, last)

- The `who` command in Unix-like operating systems is used to display information about users who are currently logged in to the system. It has several options for displaying system status information. For example, the `-b` option shows the last time the system started (booted), and the `-r` option shows the time the system reached the current run level:</br></br>
`ikechukwu@ubuntu-22-04-3:~$ who -b -r`</br>
         system boot  	2013-10-11 09:54</br>
         run-level 5    2013-10-11 09:54

- The first line of output from the `w` command is identical to that of the `uptime` command. It shows the current time, how long the system has been running, the total number of users currently logged on and the load on the system averaged over the last 1, 5, and 15-minute time periods. Load average is CPU utilization where, for a single-core system, a value of 1 would mean 100% CPU usage during that period of time. For a dual-core system, it would mean 50% CPU usage, and for a quad-core system, it would mean 25% CPU usage.

The following describes the rest of the output of the `w` command:

| Column | Example	| Description |
|-----|-----|-----|
| USER	| root	| The name of the user who is logged in. |
| TTY	| tty2	| Which terminal window the user is working in. | 
| FROM	| example.com	| Where the user logged in from. |
| LOGIN@	| 10:00	| When the user logged in. |
| IDLE	| 43:44	| How long the user has been idle since the last command was executed? |
| JCPU	| 0.01s	| The total CPU time used by all processes run since login. |
| PCPU	| 0.01s	| The total CPU time for the current process. |
| WHAT	| -bash	| The current process that the user is running. |

- The `last` command reads the entire login history from the `/var/log/wtmp` file and displays all logins and reboot records by default. An interesting detail of the reboot records is that it displays the version of the Linux kernel that was booted instead of the login location. The `/var/log/wtmp` file keeps a log of all users who have logged in and out of the system.</br></br>
The `last` command is slightly different from the `who` and `w` commands. By default, it also shows the username, terminal, and login location, not just of the current login sessions, but previous sessions as well.</br></br>
The `who` command reads from the `/var/run/utmp` file which logs current users, while the `last` command reads from the `/var/log/wtmp` file, which keeps a history of all user logins.
